#!/usr/bin/env zsh
# Usage: run-server <tile-config.json> <opts> <database>
# Order is enforced

dn=${0:a:h}

# Currently we serve tiles and features on two different ports but this is annoying for the long term
$dn/node_modules/.bin/tessera --require tilelive-mapnik --port 3005 --config $1 & PIDTILES=$!
shift
coffee $dn/index.coffee $@ & PIDSERVER=$!

wait $PIDTILES
wait $PIDSERVER
